#========================================================================
#
# JNI Adapter Makefile
#
# Copyright 2013 Joseph Beard
#
#========================================================================

SHELL = /bin/sh

prefix = @prefix@
srcdir = @srcdir@
VPATH = @srcdir@

GOOSRCDIR = $(srcdir)/../goo
GOOLIBDIR = ../goo
FOFISRCDIR = $(srcdir)/../fofi
FOFILIBDIR = ../fofi
SPLASHSRCDIR = $(srcdir)/../splash
SPLASHLIBDIR = ../splash
XPDFSRCDIR = $(srcdir)/../xpdf
XPDFLIBDIR = ../xpdf

JAVA_HOME = @JAVA_HOME@
JDKHEADERS = @JDKHEADERS@

CXXFLAGS = @CXXFLAGS@ @DEFS@ -I.. -I$(GOOSRCDIR) -I$(FOFISRCDIR) -I$(SPLASHSRCDIR) -I$(XPDFSRCDIR) $(JDKHEADERS) -I$(srcdir) @freetype2_CFLAGS@ @Sgm_CFLAGS@ @Xm_CFLAGS@ @Xt_CFLAGS@ @Xp_CFLAGS@ @Xext_CFLAGS@ @Xpm_CFLAGS@ @t1_CFLAGS@ @libpaper_CFLAGS@ @X_CFLAGS@ -fPIC

LDFLAGS = @LDFLAGS@

T1LIBS = @t1_LIBS@
FTLIBS = @freetype2_LIBS@

OTHERLIBS = @LIBS@ \
	-L$(XPDFLIBDIR) -lxpdf \
	-L$(SPLASHLIBDIR) -lsplash \
	-L$(FOFILIBDIR) -lfofi \
	-L$(GOOLIBDIR) -lGoo

CXX = @CXX@
AR = @AR@
RANLIB = @RANLIB@

LIBPREFIX = @LIBPREFIX@
EXE = @EXE@
DLLEXT = @DLLEXT@

#------------------------------------------------------------------------

.SUFFIXES: .cpp

.cpp.o:
	$(CXX) $(CXXFLAGS) -c $<

#------------------------------------------------------------------------

CXX_SRC = \
	$(srcdir)/Handle.cpp \
	$(srcdir)/JavaObjectWrapper.cpp \
	$(srcdir)/GlobalParameters.cpp \
	$(srcdir)/PDFDocument.cpp \
	$(srcdir)/PDFPage.cpp \
	$(srcdir)/TextCollector.cpp

#------------------------------------------------------------------------

all: $(LIBPREFIX)xpdf-jni$(DLLEXT) test

#------------------------------------------------------------------------

JNI_OBJS = \
	Handle.o \
	JavaObjectWrapper.o \
	GlobalParameters.o \
	PDFDocument.o \
	PDFPage.o \
	TextCollector.o

JNI_LIBS = $(T1LIBS) $(FTLIBS) $(XLIBS) $(OTHERLIBS) -lm

$(LIBPREFIX)xpdf-jni$(DLLEXT): $(JNI_OBJS)
	rm -f $(LIBPREFIX)xpdf-jni$(DLLEXT)
	$(CXX) $(LDFLAGS) -shared -o $@ $(JNI_OBJS) $(OTHERLIBS)

#------------------------------------------------------------------------

TEST_OBJS = test.o

test$(EXE): $(TEST_OBJS) $(LIBPREFIX)xpdf-jni$(DLLEXT)
	$(CXX) $(LDFLAGS) -L. -lxpdf-jni -o $@ $(TEST_OBJS)

#------------------------------------------------------------------------

clean:
	rm -f $(JNI_OBJS) $(LIBPREFIX)xpdf-jni.a
	rm -f $(LIBPREFIX)xpdf-jni$(DLLEXT)
	rm -f $(TEST_OBJS) test$(EXE)

#------------------------------------------------------------------------

depend:
	$(CXX) $(CXXFLAGS) -MM $(CXX_SRC) >Makefile.dep

include Makefile.dep
